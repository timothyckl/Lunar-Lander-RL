import numpy as np


class Mutation:
    def __init__(
        self, 
        mutation_rate=0.1,
        type='gaussian',
        mutation_range=0.1
        ):
        self.type = type
        self.mutation_rate = mutation_rate
        self.mutation_range = mutation_range
        self.valid_types = ['gaussian', 'random']
        if self.type not in self.valid_types:
            raise ValueError(f'Invalid mutation type. Valid types are: {self.valid_types}')

    def random_mutation(self, solution):
        length = len(solution)
        samples = np.random.binomial(length, self.mutation_rate)
        mutation_indices = np.random.choice(length, samples, replace=False)
        mutation_values = np.random.uniform(-self.mutation_range, self.mutation_range, samples)        
        solution[mutation_indices] += mutation_values
        
        return solution

    def gaussian_mutation(self, solution):
        length = len(solution)
        samples = np.random.binomial(length, self.mutation_rate)
        mutation_indices = np.random.choice(length, samples, replace=False)
        mutation_values = np.random.normal(0, self.mutation_range, samples)        
        solution[mutation_indices] += mutation_values
        
        return solution

    def __call__(self, solution):
        if self.type == 'gaussian':                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
            return self.gaussian_mutation(solution)
        elif self.type == 'random':
            return self.random_mutation(solution)
        else:
            raise ValueError(f'Invalid mutation type. Valid types are: {self.valid_types}')